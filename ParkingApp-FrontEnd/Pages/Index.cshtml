@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<style>
    #map {
        width: 100%;
        height: 100vh;
        min-height: 100%;
        min-width: 100%;
        position: relative;
    }
</style>

<div class="text-center">

    <div id="map"></div>

    <button type="button" class="btn btn-primary btn-lg">Parkera</button>
    <button type="button" class="btn btn-danger btn-lg">Lämna</button>
</div>

<script>
    const map = L.map('map').fitWorld();

    const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    let userMarker = L.marker([0, 0], { draggable: true });
    //
    function onLocationFound(e) {
        let radius = e.accuracy;

        // userMarker = L.marker(e.latlng, { draggable: true })
        userMarker
            .setLatLng(e.latlng)
            .addTo(map)
            .bindPopup(`You are here<br>${e.latlng.lat}, ${e.latlng.lng}`)
            // .bindPopup('You are within ' + radius + ' meters from this point')
            .openPopup();

        // L.circle(e.latlng, radius).addTo(map);
    }

    function onLocationError(e) {
        alert(e.message);
    }

    function onClick(e) {
        // const content = `You are here<br>${e.latlng.lat}, ${e.latlng.lng}`;
        // const popup = userMarker.getPopup();
        // popup.setContent(content);
        userMarker.setLatLng(e.latlng);
        updatePopup(userMarker);
        userMarker.openPopup();
        // userMarker._popup.setContent(content);
    }

    function onDragEnd(e) {
        updatePopup(userMarker);
        userMarker.openPopup();
    }

    function updatePopup(marker) {
        const latlng = marker.getLatLng();
        const content = `You are here<br>${latlng.lat}, ${latlng.lng}`;
        marker.getPopup().setContent(content);
    }

    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);
    map.on('click', onClick);
    userMarker.on('dragend', onDragEnd);
    //
    map.locate({ setView: true, maxZoom: 14 });
</script>